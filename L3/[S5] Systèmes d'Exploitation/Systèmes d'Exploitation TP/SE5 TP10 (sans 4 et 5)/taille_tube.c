#include "tp10.h"

#define BUFSIZE 65530
//pour size=32768 -> jusqu'a 2*size-30+size (alerte stack smashing)
//pour size=65536 -> jusqu'a size-30+size
//pour size=65537 -> jusqu'a size-30+size
//pour size=65530 -> jusqu'a size-30+size

char buf[BUFSIZE];

void taille_tube(){
  int fd[2];
  if(pipe(fd)==-1){
    printf("error pipe\n");
    exit(1);
  }
  fcntl(fd[1], F_SETFL, O_NONBLOCK);
  int w;
  while((w=write(fd[1], buf, BUFSIZE))>0) printf("write %d\n", w);
  int r;
  w=read(fd[0], &r, 30);
  printf("read %d\n", w);
  w=write(fd[1], buf, BUFSIZE);
  printf("write2 %d\n", w);
}

int main(){
  taille_tube();

  return 0;
}

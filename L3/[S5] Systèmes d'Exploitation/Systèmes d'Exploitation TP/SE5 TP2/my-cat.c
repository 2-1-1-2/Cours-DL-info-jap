#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>

#define BUFFER_SIZE 1024

/* ./my-cat lit l'entrée standard et la recopie sur la sortie standard,
   par blocs de taille BUFFER_SIZE. Termine avec le code 1 si une erreur
   se produit, et le code 0 sinon. */
int main() {
  char * buffer = NULL;

  /* TODO : allouer une zone mémoire de taille BUFFER_SIZE et mettre son adresse dans
     buffer. En cas d'échec de l'allocation, terminer sur une erreur (exit code : 1) */
  buffer=malloc(BUFFER_SIZE);
  if(buffer==NULL){
    free(buffer);
    printf("erreur allocation mémoire");
    return 1;
  }

  while(1) {
    /* TODO : lire un bloc de taille BUFFER_SIZE sur stdin, et mettre les données lues
       dans buffer. En cas d'erreur de lecture, terminer sur une erreur (exit code :
       1). En cas de fini de fichier, sortir de la boucle. */
    int r=read(0, buffer, BUFFER_SIZE);
    if(r==-1){
      free(buffer);
      return 1;
    }
    if(r==0) goto cleanup_return;

    /* TODO : écrire sur stdout les données qui viennent d'être lues. En cas d'erreur de
       lecture, terminer sur une erreur (exit code : 1) */
    int w=write(1, buffer, r);
    if(w==-1){
      free(buffer);
      return 1;
    }
  }
  
  /* TODO : Tout stdin a été correctement copié sur stdout : terminer avec l'exit code 0 */
  cleanup_return:
  free(buffer);
  return 0;
}
